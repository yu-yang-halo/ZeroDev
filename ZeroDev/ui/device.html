<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,maximum-scale=1,user-scalable=no" />
	<script type="text/javascript" src="js/jquery-2.1.0.js"></script>
	<script type="text/javascript" src="js/elapi.js"></script>
	<script type="text/javascript" src="js/map.js"></script>
	<title>设备列表</title>
	<link rel="stylesheet" href="css/button.css" type="text/css" charset="utf-8" />
	<link rel="stylesheet" href="css/nav.css" type="text/css" charset="utf-8" />
	<style type="text/css">
		html,body{
		height:100%;
		margin:0px auto;
		}
		#container{
		width: 100%;
		height: 100%;
		margin: 0px auto;
		position: relative;

		}

		.title{
		height: 50px;
		width: 100%;
		background-color: #333333;
		color: #FFFFFF;
		text-align: center;
		line-height: 50px;
		}
		.row{
		text-align: center;
		height: 60px;
		display:table;
		width: 100%;

		margin: auto;
		}
		span{
		display:table-cell;
		vertical-align:middle;
		}
		.in{
		background-repeat:round;
		margin-left: 5px;
		padding-left: 2px;
		border:1px solid #A9C08C;
		height: 30px;
		width:170px;
		font-size:20px;
		background-size:100%;
		}
		.radiobtn{
		height: 60px;
		width: 60px;
		}
		@keyframes fade-in {
		0% {opacity: 0;}/*初始状态 透明度为0*/
		40% {opacity: 0.5;}/*过渡状态 透明度为0*/
		100% {opacity: 1;}/*结束状态 透明度为1*/
		}
		@-webkit-keyframes fade-in {/*针对webkit内核*/
		0% {opacity: 0;}
		40% {opacity: 0.5;}
		100% {opacity: 1;}
		}
		.page {
		animation: fade-in;/*动画名称*/
		animation-duration: 0.9s;/*动画持续时间*/
		-webkit-animation:fade-in 0.9s;/*针对webkit内核*/

		}

		table{
		width: 100%;
		border-collapse: collapse;
		border:solid #A9C08C;
		border-width:1px 0px 0px 1px;
		}
		tr{
		height: 40px;
		border-bottom-color: #333333;
		}
		td{
		border:solid #A9C08C;
		border-width:0px 1px 1px 0px;
		padding:10px 0px;
		color: #333333;
		font-size:15px;
		}
		th{
		border:solid #A9C08C;
		border-width:0px 1px 1px 0px;
		padding:10px 0px;
		color: #333333;
		font-size:18px;
		}
		.button{
		  margin:2px;
		  font-size:15px
		}
		img{
		width: 80px;
		height: 80px;
		margin-top:10px;
		}

	</style>

</head>

<body bgcolor="#FFFFFF">

<div id="container">

</div>

</body>
<script type="text/javascript">

        var imagePairs=new Map();

		function initDomcument(){
		        var len = $("#container").children().length;
		        var currentIndex = 0;
		         loadNav(len,currentIndex);
                function moveLeft(){
                    if (++currentIndex >= len) {
				             currentIndex = len - 1;
			         }
			          loadNav(len,currentIndex);
			        for (var i = 0; i < len; i++) {
			              	if (i == currentIndex) {
				            	$("#page" + (i+1)).show();
			             	} else {
				            	$("#page" + (i+1)).hide();
				            }
			         }

                }
                function moveRight(){
                    if (--currentIndex < 0) {
				           currentIndex = 0;
			        }
			        loadNav(len,currentIndex);
			        for (var i = 0; i < len; i++) {
				        if (i == currentIndex) {
					          $("#page" + (i+1)).show();
				         } else {
					          $("#page" + (i+1)).hide();
			             }
			         }
                }
                addTouchEvent(document.getElementById("container"),moveLeft,moveRight);


		}

			function loadData(root,classId){
		 		                /*
		 		                 * 该类型设备UI描述页数
		 		                */
		 		                var  data=root.mobileApp;
                                var jsonClsLayout=data.ClassLayout;
                                var clslayout=[];
                                if(jsonClsLayout.constructor=Array){
                                   clslayout=jsonClsLayout;
                                }else{
                                   clslayout.push(jsonClsLayout);
                                }
		 		                var currentClassLayout;
		 		                 for(var q=0;q<clslayout.length;q++){
		 		                    if(clslayout[q].classId==classId){
		 		                       currentClassLayout=data.ClassLayout[q];
		 		                       break;
		 		                    }
		 		                 }
	                            $("#container").empty();
		 		                var jsonPage=currentClassLayout.Page;
                                var pages=[];
                                if(jsonPage.constructor==Array){
                                      pages=jsonPage;
                                }else{
                                      pages.push(jsonPage);
                                }

		 		              	for(var i=0;i<pages.length;i++){

		 		              		var titleBar="<div class='title'>"+pages[i].title+"</div>";

		 		              		var display_style="display:none;";
		 		              		/*
		 		              		 * 首页显示，其他页隐藏
		 		              		 */
		 		              		if(pages[i].num==1){
		 		              			display_style="";
		 		              		}
		 		              		/*
		 		              		 * 每页的行描述
		 		              		 */
		                            var rowselementString="";
                                    var jsonRow=pages[i].Row;
		                            var rows=[];

		                             if(jsonRow.constructor==Array){
                                        rows=jsonRow;
                                     }else{
                                        rows.push(jsonRow);
                                     }
		                            for(var j=0;j<rows.length;j++){
		                           	    var currentRow=rows[j];
		                           	    /*
		                           	     * 每一行可能有Button，LabelField，ImgRadioButton fvTable
		                           	     */
		                           	    var buttonEleString="";
		                           	    var labelFieldEleString="";
		                           	    var imgRadioButtonEleString="";
		                           	    var fvTableEleString="";
		                           	    var imageStatusEleString="";
		                           	    var imageEleString="";
		                           	    var histTableEleString="";
		                           	    //Button解析
		                           	    if(currentRow.Button!=undefined){
		                           		   var jsonButton=currentRow.Button;
		                           		   var buttonArr=[];
		                           		   if(jsonButton.constructor==Array){
                                               buttonArr=jsonButton;
                                            }else{
                                               buttonArr.push(jsonRow);
                                            }

		                           		   buttonEleString+="<span>";

		                           		   for(var k=0;k<buttonArr.length;k++){
		                           		   	   buttonEleString+="<button class='button orange' fixedValue='"+buttonArr[k].fixedValue+"'   type='"+buttonArr[k].type+"' value='"+k+"' onclick='sendCmd($(this))'>"+ buttonArr[k].text+"</button>";
		                           		   }
		                           		   buttonEleString+="</span>";
		                           	    }
		                           	    //LabelField解析
		                           	    if(currentRow.LabelField!=undefined){
		                           		   var jsonLabelField=currentRow.LabelField;
		                           		   var labelFieldArr=[];
		                           		   if(jsonLabelField.constructor==Array){
                                               labelFieldArr=jsonLabelField;
                                            }else{
                                               labelFieldArr.push(jsonLabelField);
                                            }



		                           		   for(var k=0;k<labelFieldArr.length;k++){
		                           		   	   labelFieldEleString+="<span><label>"+labelFieldArr[k].label+"</label><input class='in' fieldId='"+labelFieldArr[k].fieldId+"'/></span>";
		                           		   }
		                           	    }
		                           	    //ImgRadioButton解析
		                           	    if(currentRow.ImageRadioBut!=undefined){
		                           		   var jsonRadioBut=currentRow.ImageRadioBut;
		                           		   var imageRadioButArr=[];
		                           		   if(jsonRadioBut.constructor==Array){
                                               imageRadioButArr=jsonRadioBut;
                                            }else{
                                               imageRadioButArr.push(jsonRadioBut);
                                            }

		                           		   imgRadioButtonEleString+="<span>"
		                           		   for(var m=0;m<imageRadioButArr.length;m++){

		                           		   	   imgRadioButtonEleString+="<input type='image' onclick='buttonSwitch($(this))'  cmdFieldId='"+imageRadioButArr[m].cmdFieldId+"'   statusFieldId='"+imageRadioButArr[m].statusFieldId+"' value='0'  img1='"+imageRadioButArr[m].img1+"'  img0='"+imageRadioButArr[m].img0+"'  src='"+imageRadioButArr[m].img0+"' class='radiobtn' />";
		                           		   }
		                           		   imgRadioButtonEleString+="</span>"
		                           	    }
		                           	    //ImageStatus解析
		                           	    if(currentRow.ImageStatus!=undefined){
		                           		   var jsonImageStatus=currentRow.ImageStatus;

		                           		   var imageStatusArr=[];
		                           		   if(jsonImageStatus.constructor==Array){
                                               imageStatusArr=jsonImageStatus;
                                            }else{
                                               imageStatusArr.push(jsonImageStatus);
                                            }

		                           		   imageStatusEleString+="<span>"
		                           		   for(var m=0;m<imageStatusArr.length;m++){
		                           		       imagePairs.put(imageStatusArr[m].fieldId+"",imageStatusArr[m].ValueImagePair);
		                           		   	   imageStatusEleString+="<img  fieldId='"+imageStatusArr[m].fieldId+"' class='st'></img>";
		                           		   }
		                           		   imageStatusEleString+="</span>";
		                           	    }
		                           	     //Image解析
		                           	    if(currentRow.Image!=undefined){
		                           		   var jsonImage=currentRow.Image;

		                           		   var imageArr=[];
		                           		   if(jsonImage.constructor==Array){
                                               imageArr=jsonImage;
                                            }else{
                                               imageArr.push(jsonImage);
                                            }

		                           		   imageEleString+="<span>"
		                           		   for(var m=0;m<imageArr.length;m++){
		                           		      imageEleString+="<img src='"+imageArr[m].img+"'></img>";
		                           		   }
		                           		   imageEleString+="</span>";
		                           	    }



		                           	    //fvTable解析
		                           	    if(currentRow.FVTable!=undefined){
		                           		   var jsonFvTable=currentRow.FVTable;
		                           		   var fvTableArr=[];
		                           		   if(jsonFvTable.constructor==Array){
                                               fvTableArr=jsonFvTable;
                                            }else{
                                               fvTableArr.push(jsonFvTable);
                                            }



		                           		   fvTableEleString+="<span>";
		                           		   for(var n=0;n<fvTableArr.length;n++){

		                           		   	   var tableElement=fvTableArr[n];

		                           		   	   var jsonCell=tableElement.FVCell;
		                           		   	   var cells=[];
		                           		   	   if(jsonCell.constructor==Array){
		                           		   	       cells=jsonCell;
		                           		   	   }else{
		                           		   	       cells.push(jsonCell);
		                           		   	   }

		                           		   	   var cellString="";
		                           		   	   for(var p=0;p<cells.length;p++){
		                           		   	   	   var cell=cells[p];
		                           		   	   	   cellString+="<tr><td>"+cell.fieldId+"</td><td>"+cell.format+"</td></tr>";
		                           		   	   }
		                           		   	    fvTableEleString+=" <table class='tab'><tr><th>"+ tableElement.colname1+"</th><th>"+ tableElement.colname2+"</th></tr>"+cellString+"</table>";
		                           		   }
		                           		   fvTableEleString+="</span>"
		                           	    }

		                           	    //histTable解析

		                           	     if(currentRow.HistTable!=undefined){

		                           		   var jsonHistTable=currentRow.HistTable;


		                           		   var histTableArr=[];
		                           		   if(jsonHistTable.constructor==Array){
                                               histTableArr=jsonHistTable;
                                           }else{
                                               histTableArr.push(jsonHistTable);
                                           }

                                            histTableEleString+="<span>";

                                            for(var t=0;t<histTableArr.length;t++){
	                                            var tab=histTableArr[t];


	                                            histTableEleString+="<div  style='text-align: left;color: #000000;'><label>"+tab.name+"</label></div>";
	                                            var mrow="<tr>";
                                                for(var s=0;s<tab.colnum;s++){
                                                    mrow+="<th>"+tab.colnames[s]+"</th>";
                                                }
                                                mrow+="</tr>";
                                                histTableEleString+="<table class='histable' cmd='"+tab.query+"'>"+mrow+"</table>";
                                            }

                                            histTableEleString+="</span>";


                                          }




		                             	var rowElement="<div class='row' style='margin-top:"+pages[i].padding+"px;'>"+buttonEleString+labelFieldEleString+imgRadioButtonEleString+fvTableEleString+imageStatusEleString+imageEleString+histTableEleString+"</div>";

		                           	    rowselementString+=rowElement;
		                           }

		                              var elements=" <div class='page' id='page"+pages[i].num+"'  style='"+display_style+"'>"+titleBar+rowselementString+"</div>";



		 		              		$("#container").append(elements);


		 		              	}








		 		              	 initDomcument();

                                  $(".st").each(function(){
                                      $(this).click(function(){
                                         var fieldId=$(this).attr("fieldId");

                                          $(this).attr("src",imagePairs.get(fieldId)[0].image);

                                      })
                                  })
		 		         }

		 		                function buttonSwitch(el){
		 		                     //alert(el.attr("cmdFieldId")+":"+el.attr("statusFieldId"));
		 		                     if(el.attr("value")==0){
		 		                        el.attr("src",el.attr("img1"));
		 		                        el.attr("value",1);
		 		                     }else{
		 		                        el.attr("src",el.attr("img0"));
		 		                        el.attr("value",0);
		 		                     }

		 		                }



		 		                function sendCmd(el){
		 		                   //button type 0 1    0--命令  1--存储
		 		                   if(el.attr("type")==0){
		 		                       alert(el.attr("fixedValue"));
		 		                   }else{
		 		                      $(".in").each(function(){
		 		                         alert("fieldId: "+$(this).attr("fieldId")+" value:"+ $(this).val());
		 		                      })
		 		                   }

                                 }
	</script>

</html>